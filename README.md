# Django-Blog Mini Project

A simple blog app written using Django

'[![Build Status](https://travis-ci.org/jjackson19862017/django-blog.svg?branch=master)](https://travis-ci.org/jjackson19862017/django-blog)'
 
# Init Setup

## Install django
'sudo pip3 install django==1.11.24'

## Requirements file
'pip3 freeze > requirements.txt' --> My shortcut is 'makereq'

## Start project
'django-admin startproject' --> My shortcut is 'pstart'

so you would use 'pstart blog .'

You may need to make the manage.py file executable

'chmod +x manage.py'

## Migrate

'python3 manage.py migrate' --> My shortcut is 'migrate'

## Local Settings

Creating hidden git ignore and env.py

'echo env.py > .gitignore' --> My shortcut is 'gignore'
'echo import os > env.py' --> My shortcut is 'makeenv'

add this code to just below the import section in settings.py

'from os import path
if path.exists("env.py"):
  import env'

## Change Secret Key

and change the Secret Key (LINE 36)

'SECRET_KEY = os.environ.get('SECRET_KEY')'

KEY - can be generated by https://miniwebtool.com/django-secret-key-generator/

'os.environ["SECRET_KEY"] = "[KEY]"'

## Hostname

in env.py

'os.environ["HOSTNAME"] = "127.0.0.1"'

in settings.py (LINE 41)

'ALLOWED_HOSTS = [os.environ.get('HOSTNAME')]'

## Setting up Travis

https://travis-ci.org/ - Link the Repo to this so that you can test things.

Once you have linked the Repo, click on the Repo, look where it says "Build:Unknown: and Click on "Unknown".

Change the drop down to Markdown and copy the code underneath it.

'[![Build Status](https://travis-ci.org/jjackson19862017/django-blog.svg?branch=master)](https://travis-ci.org/jjackson19862017/django-blog)'

Create a file called '.travis.yml' and place this in the blog folder

Add this code to it
'
language: python
python:
    - "3.7"
install: "pip3 install -r requirements.txt"
script:
- SECRET_KEY="whatever" ./manage.py test
'

## Fixing Travis

Changed 3.7 from 3.4 otherwise it would fail.

# Create a New App called 'post'

Create a new app using the terminal command
'django-admin startapp posts' --> My Shortcut is 'astart' [app name]

## Post Directory

create 'templates' folder
create forms.py 'touch forms.py'

## Top Directory

create the following folders using the terminal commands.

'mkdir media static
cd media
mkdir img
cd ..
cd static
mkdir css img js'

## Update Settings.py

Because we have add posts app we need to update the settings.py

Add to INSTALLED_APPS -> 'posts',

In TEMPLATES -> 'DIRS'

Add the following code between the square brackets

'os.path.join(BASE_DIR, 'templates')'

Should look something like this ->         "'DIRS': [os.path.join(BASE_DIR, 'templates')],"

In TEMPLATES -> OPTIONS

Add the following code between the square brackets

'
'django.template.context_processors.media',
'

At the Bottom of the file, underneath STATIC_URL, Add this:

'
STATICFILES_DIRS = (os.path.join(BASE_DIR, 'static'),)

MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
'

## models.py (Post Diectory)

Add this code to the file

'
from django.utils import timezone

# Create your models here.
class Post(models.Model):
    """
    A Single Blog post
    """
    title = models.CharField(max_length=200)
    content = models.TextField()
    created_date= models.DateTimeField(auto_now_add=True)
    published_date = models.DateTimeField(blank=True, null=True, default=timezone.now)
    views = models.IntegerField(default=0)
    tag = models.CharField(max_length=30, blank=True, null=True)
    image = models.ImageField(upload_to="img", blank=True, null=True)

    def __unicode__(self):
        return self.title
'

after saving I got an error, about Pillow not being installed.

'sudo pip3 install Pillow' fixed that.

ran 'makereq' to update requirements file.

## forms.py (posts Directory)

Add this code to the file.

This will use the models.py file we have populated with code to create a form out of it.

We are only using user editable fields.

'
from django import forms
from .models import Post

class BlogPostForm(forms.ModelForm):
    class Meta:
        model = Post
        fields = ('title','content','image','tag','published_date')
'

## admin.py (posts Directory)

Add the code below

'from django.contrib import admin
from .models import Post

### Register your models here.

admin.site.register(Post)'

## views.py (posts Directory)

Add this code to it

'
from django.shortcuts import render, get_object_or_404, redirect
from django.utils import timezone
from .models import Post
from .forms import BlogPostForm


def get_posts(request):
    """
    Create a view that will return a list
    of Posts that were published prior to 'now'
    and render them to the 'blogposts.html' template
    """

    posts = Post.objects.filter(published_date__lte=timezone.now()).order_by('-published_date')
    return render(request, "blogposts.html", {'posts':posts})

def post_detail(request, pk):
    """
    Create a view that returns a single 
    Post object based on the post ID (pk) and 
    render it to the 'postdetail.html' template.
    Or return a 404 error if the post is
    not found
    """

    post = get_object_or_404(Post, pk=pk)
    post.views += 1
    post.save()
    return render(request, "postdetail.html", {'post':post})

def create_or_edit_post(request, pk=None):
    """
    Create a view that allows us to create 
    or edit a post depending if the Post ID 
    is null or not 
    """

    post = get_object_or_404(Post, pk=pk) if pk else None
    if request.method == "POST":
        form = BlogPostForm(request.POST, request.FILES, instance=post)
        if form.is_valid():
            post = form.save()
            return redirect(post_detail, post.pk)
    else:
        form = BlogPostForm(instance=post)
    return render(request, 'blogpostform.html', {'form':form})
'

## urls.py (blog Directory)

Add this code to it

'
from django.conf.urls import url, include
from django.contrib import admin
from django.views.generic import RedirectView
from django.views.static import serve
from .settings import MEDIA_ROOT

urlpatterns = [
    url(r'^admin/', admin.site.urls),
    url(r'^$', RedirectView.as_view(url='posts/')),
    url(r'^posts/', include('posts.urls')),
    url(r'^media/(?P<path>.*)$', serve, {'document_root': MEDIA_ROOT})
]

### Create a urls.py in post

## urls.py (post Directory)

Add this code to it

'
from django.conf.urls import url
from .views import get_posts, post_detail, create_or_edit_post

urlpatterns = [
    url(r'^$', get_posts, name='get_posts'),
    url(r'^(?P<pk>\d+)/$', post_detail, name='post_detail'),
    url(r'^new/$', create_or_edit_post, name='new_post'),
    url(r'^(?P<pk>\d+)/edit/$', create_or_edit_post, name='edit_post')
]
'